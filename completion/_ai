#compdef ai
local -a cmds
cmds=(list current switch add edit doctor version)

_ai_profiles() {
  ai list 2>/dev/null | tail -n +2 | awk '{print $1}'
}

_arguments \
  '1: :->subcmd' \
  '*::arg:->args'

case $state in
  subcmd)
    _describe -t commands 'ai commands' cmds
  ;;
  args)
    case $words[2] in
      switch|edit)
        _values 'profiles' $(_ai_profiles)
      ;;
      add)
        _values 'options' --force --switch --from-current
      ;;
    esac
  ;;
esac